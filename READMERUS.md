# ESCFLARE

## Скрипт добавления/обновления DNS записей сервиса CloudFlare

![](https://github.com/alive-corpse/escflare/raw/master/screen.png)

### Возможности:
* обновление dns записи, в случае её отсутствия - создание записи
* работа на OpenWRT и подобных прошивках, для OpenWRT необходима установка пакетов ca-bundle и curl
* передача параметров в командной строке, либо сохранение в самом скрипте
* обновление сразу нескольких записей для одного домена
* передача в качестве параметра либо IP адреса, либо имени интерфейса

##### Примечание: на текущий момент скрипт рассчитан на работу только с записями A-типа.

### Установка:
```bash
wget https://raw.githubusercontent.com/alive-corpse/escflare/master/escflare
chmod +xw escflare
```

### Использование:

Для использования необходим глобальный ключ API. Его можно найти в профиле аккаунта CloudFlare.

##### Простой способ использования
```
./escflare <add|create|update> <subdomain>.<domain.name> <iface|ip> [ttl]
```
Примеры:
```bash
# vailiy.pupkin.ru - доменное имя с сабдоменом
# wan0 - имя интерфейса, можно указать вместо IP адреса
./escflare update vasiliy.pupkin.ru wan0
```
```bash
# в случае обновления нескольких записей, сабдомены можно указать через запятую (без пробелов), в том числе можно указывать символы '*' и '@' для обновления соответствующих записей, в этом случае первый параметр нужно заключить в одиночные кавычки
./escflare 'vasiliy,*,ivan,sergey.pupkin.ru' 123.234.123.234 14400
```

##### Примечания
При первом запуске скрипт в интерактивном режиме запросит необходимые для авторизации данные и ttl по умолчанию для обновления записей, после чего сохранит их внутри себя.

После успешного обновления скрипт сохранит доменные имена, содержимое записи и ttl внутри себя и при последующем запуске с теми же параметрами зона обновлена не будет. Для принудительного обновления зоны в подобных случаях необходимо задать непустое значение переменной forcedupdate.

### Получение списка параметров
Вы можете получить значения всех установленных переменных:

```bash
./escflare <list|ls|show>
```

### Установка/обновление параметров

Обновление данных авторизации:
```bash
./escflare set cred
```

Обновление значения ttl по умолчанию:
```bash
./escflare set ttl
```

Обновление имени интерфейса по умолчанию:
```bash
./escflare set iface
```

Обновление переменной forcedupdate:
```bash
./escflare set forcedupdate
```

### Очистка/сброс параметров

Очистка переменной по имени:
```bash
./escflare <clean|clear> <variable name>
```

Очистка основных параметров:
```bash
./escflare <clean|clear> all
```

### Логирование

Есть три уровня логирования: debug/info/warning, по умолчанию стоит уровень info. Для изменения измените значение переменной llevel:
```bash
./escflare set llevel
```
Так же можно временно изменить уровень логирования с помощью переменной окружения ll:
```bash
ll=debug ./escflare update vasiliy.pupkin.ru wan0
```

