# ESCFLARE

## Скрипт добавления/обновления DNS записей сервиса CloudFlare

![](https://github.com/alive-corpse/escflare/raw/master/screen.png)

### Возможности:
* обновление dns записи, в случае её отсутствия - создание записи
* работа на OpenWRT и подобных прошивках, для OpenWRT необходима установка пакетов ca-bundle и curl
* передача параметров в командной строке, либо прописывание в самом скрипте
* обновление сразу нескольких записей для одного домена
* передача в качестве параметра либо IP адреса, либо имени интерфейса

##### Примечание: скрипт изначально рассчитан на работу только с записями A-типа.

### Установка:
```bash
wget https://raw.githubusercontent.com/alive-corpse/escflare/master/escflare
chmod +xw escflare
```

### Использование:

Для использования необходим глобальный ключ API. Его можно найти в профиле аккаунта CloudFlare.

##### Передача параметров в командной строке
```
./escflare <add|create|update> <subdomain>.<domain.name> <iface|ip> [ttl]
```
Примеры:
```bash
# vailiy.pupkin.ru - доменное имя с сабдоменом
# wan0 - имя интерфейса, можно указать вместо IP адреса
./escflare update vasiliy.pupkin.ru wan0
```
```bash
# в случае обновления нескольких записей, сабдомены можно указать через запятую (без пробелов), в том числе можно указывать символы '*' и '@' для обновления соответствующих записей, в этом случае первый параметр нужно заключить в одиночные кавычки
./escflare 'vasiliy,*,ivan,sergey.pupkin.ru' 123.234.123.234 14400
```

##### Примечание
При первом запуске скрипт в интерактивном режиме запросит необходимые для авторизации данные и ttl по умолчанию для обновления записей, после чего сохранит их внутри себя.

### Логирование

Есть три уровня логирования: debug/info/warning, по умолчанию стоит уровень info. Для изменения найдите и замените значение в строке:
```bash
LOGLEVEL='info'
```
По умолчанию текущая дата и время, формат и содержимое в строке:
```bash
LPREF='date +%Y.%m.%d-%H:%M:%S'
```
Ширина разделителя при отсутствии tput:
```bash
DEFAULT_COLS=70
```
Включение/отключение цвета в выводе:
```bash
LCOLOR=1
```
